webpackJsonp([1],{"+Gxq":function(t,n,e){"use strict";var o=e("fnDg").a,r=e("VU/8")(o,null,!1,function(t){e("NXGl")},null,null);n.a=r.exports},"0YWy":function(t,n){},"3sde":function(t,n){},"5W1q":function(t,n){},"85bH":function(t,n){},"9M+g":function(t,n){},GCFT:function(t,n){},"HUt/":function(t,n,e){"use strict";var o=e("qRo1").a,r=e("VU/8")(o,null,!1,function(t){e("kNIM")},null,null);n.a=r.exports},JCpY:function(t,n,e){"use strict";var o=e("rKsW").a,r=e("VU/8")(o,null,!1,function(t){e("0YWy")},null,null);n.a=r.exports},JDVb:function(t,n,e){"use strict";var o=e("9NuQ").a,r=e("VU/8")(o,null,!1,function(t){e("jdje")},null,null);n.a=r.exports},Jmt5:function(t,n){},Kku6:function(t,n){},NHnr:function(t,n,e){"use strict";function o(t){return t.state.openidConfiguration?c.a.resolve(t.state.openidConfiguration):P.openid.configuration?c.a.resolve(P.openid.configuration):I.get(P.openid.issuerUrl+"/.well-known/openid-configuration").then(function(n){return t.commit("setOpenidConfiguration",n.data),n.data})}Object.defineProperty(n,"__esModule",{value:!0});var r=e("7+uW"),s=e("Dd8w"),i=e.n(s),a=e("//Fk"),c=e.n(a),u=e("Zrlr"),l=e.n(u),d=e("wxAW"),f=e.n(d),p=e("O3w4"),h=e.n(p),m=e("r+n+"),v=e.n(m),b=new(function(){function t(){l()(this,t)}return f()(t,[{key:"connect",value:function(t,n,e,o,r){var s=this;return this.vm=t,this.useSockJS=!window.WebSocket,this.url=this.useSockJS?e:n,this.useSockJS?this.client=v.a.over(function(){return new h.a(s.url,{debug:!1})},{debug:!1}):this.client=v.a.client(this.url,{debug:!1}),this.client.reconnect_delay=5e3,new c.a(function(t,n){return s.vm.doWillConnect(s.client),s.client.connect(o,r,function(n){s.vm.doConnect(s.client),t(s.client,n)},function(t){s.vm.doError(t),n(t)}),s.client})}},{key:"disconnect",value:function(){this.client.disconnect(),this.vm.doDisconnect()}}]),t}()),g=e("NYxO"),_={name:"RabbitmqConnector",computed:i()({},Object(g.d)("stomp",{client:"client",connecting:"connecting",connected:"connected",errorState:"error"}),Object(g.d)("auth",["auth"])),methods:i()({connectButtonClicked:function(){var t=this.auth?this.auth.access_token:void 0,n=this.websocketUrl;t&&(n+="?access_token="+t),b.connect(this,n,this.sockJSUrl,this.username,this.password)},disconnectButtonClicked:function(){b.disconnect()}},Object(g.c)("stomp",["doConnect","doWillConnect","doDisconnect","doError"])),props:{username:String,password:String,websocketUrl:String,sockJSUrl:String},beforeDestroy:function(){this.client&&(this.client.disconnect(),this.client=null)}},w={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"rabbitmq-connector"},[this.errorState?n("b-badge",{attrs:{variant:"danger"}},[this._v(this._s(this.errorState))]):this._e(),this._v(" "),this.connecting?n("b-badge",{staticClass:"font-weight-bold",attrs:{variant:"warning"}},[this._v("Connecting ...")]):this._e(),this._v(" "),this.connected&&!this.connecting?n("b-badge",{staticClass:"font-weight-bold",attrs:{variant:"success"}},[this._v("Connected")]):n("b-badge",{staticClass:"font-weight-bold",attrs:{variant:"warning"}},[this._v("Not connected")]),this._v(" "),this.connected?n("b-button",{attrs:{size:"sm"},on:{click:this.disconnectButtonClicked}},[n("i",{staticClass:"fa fa-plug",attrs:{"aria-hidden":"true"}}),this._v(" Disconnect\n  ")]):n("b-button",{attrs:{size:"sm"},on:{click:this.connectButtonClicked}},[n("i",{staticClass:"fa fa-plug",attrs:{"aria-hidden":"true"}}),this._v(" Connect\n  ")])],1)},staticRenderFns:[]},k={components:{StompConnector:e("VU/8")(_,w,!1,function(t){e("X98T")},"data-v-0f9cdf37",null).exports},name:"AppHeader"},C={render:function(){var t=this.$createElement,n=this._self._c||t;return n("b-navbar",{attrs:{toggleable:"md",type:"dark",variant:"info"}},[n("b-navbar-toggle",{attrs:{target:"nav_collapse"}}),this._v(" "),n("b-navbar-brand",{attrs:{to:{name:"Main"}}},[n("i",{staticClass:"fa fa-home",attrs:{title:"Notification","aria-hidden":"true"}})]),this._v(" "),n("b-navbar-brand",{attrs:{to:{name:"Login"}}},[this._v("Login")]),this._v(" "),n("b-navbar-brand",{attrs:{to:{name:"Notifications"}}},[this._v("Notifications")]),this._v(" "),n("stomp-connector",{staticClass:"stomp-connector",attrs:{username:"admin",password:"admin",websocketUrl:"ws://localhost:8082/stomp"}})],1)},staticRenderFns:[]},y={name:"app",components:{AppHeader:e("VU/8")(k,C,!1,function(t){e("po4Y")},"data-v-6f602072",null).exports}},S={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",{attrs:{id:"app"}},[n("app-header"),this._v(" "),n("div",{staticClass:"main-content"},[n("router-view")],1)],1)},staticRenderFns:[]},x=e("VU/8")(y,S,!1,function(t){e("mjqL")},null,null).exports,T=e("/ocq"),U={name:"Notifications",data:function(){return{subscription:null,notifications:[]}},props:{destination:String},computed:i()({},Object(g.d)("stomp",["error","client","connected"])),watch:{connected:{immediate:!0,handler:function(t){this.updateSubscription(this.destination)}},destination:function(t){this.updateSubscription(t)}},methods:{updateSubscription:function(t){this.client&&this.client.connected?(this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.subscription=this.client.subscribe(t,this.messageHandler)):this.subscription=null},messageHandler:function(t){if("application/json"!==t.headers["content-type"]&&"application/json;charset=UTF-8"!==t.headers["content-type"])throw new Error("Unknown content type: "+t.headers["content-type"]);this.notifications.push(JSON.parse(t.body))}}},W={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"notifications"},[e("b-container",[e("b-row",[e("b-col",[t._l(t.notifications,function(n){return[e("b-card",{staticClass:"mt-2 mb-2"},[e("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n              "+t._s(n.content.title)+"\n            ")]),t._v(" "),e("div",[t._v("\n              "+t._s(n.content.message)+"\n            ")])])]})],2)],1)],1)],1)},staticRenderFns:[]},j=e("VU/8")(U,W,!1,function(t){e("3sde")},"data-v-13c160d2",null).exports,N={render:function(){var t=this.$createElement;return(this._self._c||t)("div")},staticRenderFns:[]},D=e("VU/8")({name:"Main"},N,!1,function(t){e("85bH")},"data-v-04223220",null).exports,q={name:"Login",data:function(){return{error:null,form:{username:null,password:null}}},computed:Object(g.d)("auth",["auth"]),methods:i()({},Object(g.b)("auth",["login"]),{submit:function(){var t=this;this.login(this.form).then(function(){t.error=null,t.$router.push({name:"Main"})}).catch(function(n){throw n.response&&n.response.data&&n.response.data.error_description?t.error=n.response.data.error_description:n.response&&n.response.data&&n.response.data.error?t.error=n.response.data.error:t.error=n.message,n})}})},J={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"login"},[e("b-container",[e("b-row",[e("b-col",{staticClass:"mx-auto",attrs:{md:"4"}},[e("b-card",{staticClass:"login__card",class:{"login__card--error":t.error}},[e("h5",{staticClass:"mb-0",attrs:{slot:"header"},slot:"header"},[t._v("Connexion")]),t._v(" "),e("b-form",{on:{submit:function(n){n.preventDefault(),t.submit(n)}}},[e("b-form-group",{staticClass:"login__username-group"},[e("b-form-input",{attrs:{type:"text",required:"",placeholder:"Nom d'utilisateur"},model:{value:t.form.username,callback:function(n){t.$set(t.form,"username",n)},expression:"form.username"}})],1),t._v(" "),e("b-form-group",{staticClass:"login__password-group"},[e("b-form-input",{attrs:{type:"password",required:"",placeholder:"Mot de passe"},model:{value:t.form.password,callback:function(n){t.$set(t.form,"password",n)},expression:"form.password"}})],1),t._v(" "),e("b-button",{staticClass:"login__submit-button",attrs:{variant:"primary",type:"submit"}},[t._v("Se connecter")])],1),t._v(" "),t.error?e("div",{staticClass:"login__footer",attrs:{slot:"footer"},slot:"footer"},[e("span",{staticClass:"login__message--error"},[t._v(t._s(t.error))])]):t._e()],1)],1)],1)],1)],1)},staticRenderFns:[]},O=e("VU/8")(q,J,!1,function(t){e("GCFT")},"data-v-39ab08dd",null).exports;r.a.use(T.a);var V=new T.a({routes:[{path:"/",name:"Main",component:D},{path:"/login",name:"Login",component:O},{path:"/notifications",name:"Notifications",component:j,props:{destination:"/user/queue/notification"}}]}),A=e("OAwv"),F=e.n(A),R=e("ytdl"),E=e.n(R),M=e("mtWM"),H=e.n(M),$=function(){return H.a.create()},L=$();L.interceptors.request.use(function(t){var n=G.getters["auth/accessToken"];return n&&(t.headers.Authorization="Bearer "+n),t}),L.interceptors.response.use(function(t){return t},function(t){if(401!==t.response.status||!t.response||!t.response.data||"invalid_token"!==t.response.data.error)throw t;var n=t.config;n.baseURL=null;var e=G.getters["auth/refreshToken"];return console.log("Refreshing JWT ..."),G.dispatch("auth/refresh",{refresh_token:e}).then(function(t){return console.log("JWT Refreshed !"),L.request(n)}).catch(function(t){throw console.log("JWT Refresh Failed !"),"invalid_grant"===t.response.data.error&&(console.log(t.response.data),G.commit("auth/setAuthPayload",null)),t})});var I=$(),P={openid:{clientId:"jwt",clientSecret:"jwt",configuration:{token_endpoint:"/auth/oauth/token",end_session_endpoint:null}}},Y={namespaced:!0,state:{openidConfiguration:null,auth:null,accessTokenDecoded:null,refreshTokenDecoded:null},mutations:{setAuthPayload:function(t,n){n?(t.auth=n,t.accessTokenDecoded=E()(n.access_token),t.refreshTokenDecoded=n.refresh_token?E()(n.refresh_token):n.refresh_token):(t.auth=null,t.accessTokenDecoded=null,t.refreshTokenDecoded=null)},setOpenidConfiguration:function(t,n){t.openidConfiguration=n}},actions:{login:function(t,n){return o(t).then(function(t){var e={grant_type:"password",username:n.username,password:n.password},o=F.a.stringify(e),r={username:P.openid.clientId,password:P.openid.clientSecret};return I.post(t.token_endpoint,o,{auth:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}).then(function(n){return t.commit("setAuthPayload",n.data),n.data})},refresh:function(t,n){return o(t).then(function(e){var o={grant_type:"refresh_token",refresh_token:n.refresh_token},r=F.a.stringify(o),s={username:P.openid.clientId,password:P.openid.clientSecret};return I.post(e.token_endpoint,r,{auth:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(n){return t.commit("setAuthPayload",n.data),n.data})})},logout:function(t){return o(t).then(function(n){var e=void 0;if(n.end_session_endpoint){var o={refresh_token:t.state.auth.refresh_token},r=F.a.stringify(o),s={username:P.openid.clientId,password:P.openid.clientSecret};e=I.post(n.end_session_endpoint,r,{auth:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}else e=c.a.resolve();return e.then(function(n){return t.commit("setAuthPayload",null),n.data})})}},getters:{auth:function(t){return t.auth},accessToken:function(t){return t.auth?t.auth.access_token:null},refreshToken:function(t){if(t.auth){return t.auth.refresh_token}return null}}};r.a.use(g.a);var B={namespaced:!0,state:{client:null,connecting:!1,connected:!1,error:null},mutations:{doWillConnect:function(t,n){t.error=null,t.connecting=!0,t.connected=!1,t.client=n},doConnect:function(t,n){t.error=null,t.connecting=!1,t.client=n,t.connected=!0},doDisconnect:function(t){t.error=null,t.connecting=!1,t.connected=!1,t.client=null},doError:function(t,n){t.error||(t.error=n.body?n.body:n),t.connecting=!1,t.connected=!1,t.client=null}},getters:{client:function(t){return t.client},error:function(t){return t.error},connected:function(t){return t.connected},connecting:function(t){return t.connecting}}};r.a.use(g.a);var G=new g.a.Store({state:{},modules:{auth:Y,stomp:B}}),X=e("e6fC");e("Jmt5"),e("9M+g"),e("5W1q");r.a.use(X.a),r.a.config.productionTip=!1,new r.a({el:"#app",router:V,store:G,template:"<App/>",components:{App:x}})},NXGl:function(t,n){},SsFf:function(t,n,e){"use strict";var o=e("xT7b").a,r=e("VU/8")(o,null,!1,function(t){e("Kku6")},null,null);n.a=r.exports},X98T:function(t,n){},jdje:function(t,n){},kNIM:function(t,n){},mjqL:function(t,n){},po4Y:function(t,n){},r15W:function(t,n,e){"use strict";var o=e("E9Zr").a,r=e("VU/8")(o,null,!1,function(t){e("weWZ")},null,null);n.a=r.exports},weWZ:function(t,n){}},["NHnr"]);
//# sourceMappingURL=app.91bb2a20909dbd1ccd4f.js.map