webpackJsonp([1],{"+Gxq":function(t,n,e){"use strict";var o=e("fnDg").a,r=e("VU/8")(o,null,!1,function(t){e("NXGl")},null,null);n.a=r.exports},"0YWy":function(t,n){},"0z4h":function(t,n){},"1AM3":function(t,n){},"5W1q":function(t,n){},"6inx":function(t,n){},"9M+g":function(t,n){},"HUt/":function(t,n,e){"use strict";var o=e("qRo1").a,r=e("VU/8")(o,null,!1,function(t){e("kNIM")},null,null);n.a=r.exports},JCpY:function(t,n,e){"use strict";var o=e("rKsW").a,r=e("VU/8")(o,null,!1,function(t){e("0YWy")},null,null);n.a=r.exports},JDVb:function(t,n,e){"use strict";var o=e("9NuQ").a,r=e("VU/8")(o,null,!1,function(t){e("jdje")},null,null);n.a=r.exports},Jmt5:function(t,n){},K8kB:function(t,n){},Kku6:function(t,n){},NHnr:function(t,n,e){"use strict";function o(t){return t.state.openidConfiguration?c.a.resolve(t.state.openidConfiguration):b.openid.configuration?c.a.resolve(b.openid.configuration):z.get(b.openid.issuerUrl+"/.well-known/openid-configuration").then(function(n){return t.commit("setOpenidConfiguration",n.data),n.data})}Object.defineProperty(n,"__esModule",{value:!0});var r=e("7+uW"),i=e("Dd8w"),s=e.n(i),a=e("//Fk"),c=e.n(a),u=e("Zrlr"),l=e.n(u),d=e("wxAW"),h=e.n(d),f=e("O3w4"),p=e.n(f),m=e("r+n+"),v=e.n(m),b={stomp:{username:"admin",password:"admin",url:"ws://localhost:8082/stomp"},emissionService:{url:"/emission"},openid:{clientId:"jwt",clientSecret:"jwt",configuration:{token_endpoint:"/auth/oauth/token",end_session_endpoint:null}}},g=new(function(){function t(){l()(this,t)}return h()(t,[{key:"connect",value:function(t,n){var e=this;this.vm=t;var o=n?n.access_token:void 0,r=b.stomp.url;return o&&(r+="?access_token="+o),this.useSockJS=!window.WebSocket,this.url=r,this.useSockJS?this.client=v.a.over(function(){return new p.a(e.url,{debug:!1})},{debug:!1}):this.client=v.a.client(this.url,{debug:!1}),this.client.reconnect_delay=5e3,new c.a(function(t,n){return e.vm.doWillConnect(e.client),e.client.connect(b.stomp.username,b.stomp.password,function(n){e.vm.doConnect(e.client),t(e.client,n)},function(t){e.vm.doError(t),n(t)}),e.client})}},{key:"disconnect",value:function(){this.client.disconnect(),this.vm.doDisconnect()}}]),t}()),_=e("NYxO"),w={name:"RabbitmqConnector",computed:s()({},Object(_.d)("stomp",{client:"client",connecting:"connecting",connected:"connected",errorState:"error"}),Object(_.d)("auth",["auth"])),props:{actionnable:!1},methods:s()({connectButtonClicked:function(){g.connect(this,this.auth)},disconnectButtonClicked:function(){g.disconnect()}},Object(_.c)("stomp",["doConnect","doWillConnect","doDisconnect","doError"])),beforeDestroy:function(){this.client&&(this.client.disconnect(),this.client=null)}},k={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",[this.errorState?n("b-badge",{attrs:{variant:"danger"}},[this._v(this._s(this.errorState))]):this._e(),this._v(" "),this.connecting?n("b-badge",{staticClass:"font-weight-bold",attrs:{variant:"warning"}},[this._v("Connecting ...")]):this._e(),this._v(" "),this.connected&&!this.connecting?n("b-badge",{staticClass:"font-weight-bold",attrs:{variant:"success"}},[this._v("Connected")]):this._e(),this._v(" "),this.connected||this.connecting?this._e():n("b-badge",{staticClass:"font-weight-bold",attrs:{variant:"warning"}},[this._v("Not connected")]),this._v(" "),this.actionnable?[this.connected?n("b-button",{attrs:{size:"sm"},on:{click:this.disconnectButtonClicked}},[n("i",{staticClass:"fa fa-plug",attrs:{"aria-hidden":"true"}}),this._v(" Disconnect\n    ")]):n("b-button",{attrs:{size:"sm"},on:{click:this.connectButtonClicked}},[n("i",{staticClass:"fa fa-plug",attrs:{"aria-hidden":"true"}}),this._v(" Connect\n    ")])]:this._e()],2)},staticRenderFns:[]},C=e("VU/8")(w,k,!1,function(t){e("K8kB")},"data-v-311b1fca",null).exports,y={name:"LoginHeader",computed:Object(_.d)("auth",["auth","accessTokenDecoded"]),methods:s()({},Object(_.b)("auth",["logout"]),{doLogout:function(){var t=this;this.logout().then(function(){return t.$router.push({name:"Login"})})},doLogin:function(){this.$router.push({name:"Login"})}})},x={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.auth?e("div",[e("b-badge",{attrs:{variant:"success"}},[t._v(t._s(t.accessTokenDecoded.user_name))]),t._v(" "),e("b-badge",{attrs:{variant:"success"}},[t._v(t._s(t.accessTokenDecoded.user_uuid))]),t._v(" "),e("b-button",{attrs:{variant:"warning",size:"sm"},on:{click:function(n){t.doLogout()}}},[t._v("Logout")])],1):e("div",[e("b-badge",[t._v("Anonymous")]),t._v(" "),e("b-button",{attrs:{variant:"warning",size:"sm"},on:{click:function(n){t.doLogin()}}},[t._v("Login")])],1)},staticRenderFns:[]},j={components:{StompConnector:C,LoginHeader:e("VU/8")(y,x,!1,function(t){e("0z4h")},"data-v-0bee4394",null).exports},computed:Object(_.d)("auth",["auth"]),name:"AppHeader"},S={render:function(){var t=this.$createElement,n=this._self._c||t;return n("b-navbar",{attrs:{toggleable:"md",type:"dark",variant:"info"}},[n("b-row",[n("b-col"),this._v(" "),n("b-col")],1),this._v(" "),n("b-navbar-toggle",{attrs:{target:"nav_collapse"}}),this._v(" "),n("b-navbar-brand",[this._v("Notifications")]),this._v(" "),n("div",{staticClass:"ml-auto"},[this.auth?n("b-navbar-brand",[n("stomp-connector")],1):this._e(),this._v(" "),n("b-navbar-brand",[n("login-header",{staticClass:"mx-2"})],1)],1)],1)},staticRenderFns:[]},T={name:"app",components:{AppHeader:e("VU/8")(j,S,!1,function(t){e("sc01")},"data-v-5f273f56",null).exports}},O={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",{attrs:{id:"app"}},[n("app-header"),this._v(" "),n("div",{staticClass:"main-content"},[n("router-view")],1)],1)},staticRenderFns:[]},D=e("VU/8")(T,O,!1,function(t){e("mjqL")},null,null).exports,W=e("/ocq"),L=e("mtWM"),U=e.n(L),A=e("OAwv"),V=e.n(A),N=e("ytdl"),R=e.n(N),$={namespaced:!0,state:{openidConfiguration:null,auth:null,accessTokenDecoded:null,refreshTokenDecoded:null},mutations:{setAuthPayload:function(t,n){n?(t.auth=n,t.accessTokenDecoded=R()(n.access_token),t.refreshTokenDecoded=n.refresh_token?R()(n.refresh_token):n.refresh_token):(t.auth=null,t.accessTokenDecoded=null,t.refreshTokenDecoded=null)},setOpenidConfiguration:function(t,n){t.openidConfiguration=n}},actions:{login:function(t,n){return o(t).then(function(t){var e={grant_type:"password",username:n.username,password:n.password},o=V.a.stringify(e),r={username:b.openid.clientId,password:b.openid.clientSecret};return z.post(t.token_endpoint,o,{auth:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}).then(function(n){return t.commit("setAuthPayload",n.data),n.data})},refresh:function(t,n){return o(t).then(function(e){var o={grant_type:"refresh_token",refresh_token:n.refresh_token},r=V.a.stringify(o),i={username:b.openid.clientId,password:b.openid.clientSecret};return z.post(e.token_endpoint,r,{auth:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(n){return t.commit("setAuthPayload",n.data),n.data})})},logout:function(t){return o(t).then(function(n){var e=void 0;if(n.end_session_endpoint){var o={refresh_token:t.state.auth.refresh_token},r=V.a.stringify(o),i={username:b.openid.clientId,password:b.openid.clientSecret};e=z.post(n.end_session_endpoint,r,{auth:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}else e=c.a.resolve();return e.then(function(){t.commit("setAuthPayload",null)})})}},getters:{auth:function(t){return t.auth},accessToken:function(t){return t.auth?t.auth.access_token:null},refreshToken:function(t){if(t.auth){return t.auth.refresh_token}return null}}};r.a.use(_.a);var q={namespaced:!0,state:{client:null,connecting:!1,connected:!1,error:null},mutations:{doWillConnect:function(t,n){t.error=null,t.connecting=!0,t.connected=!1,t.client=n},doConnect:function(t,n){t.error=null,t.connecting=!1,t.client=n,t.connected=!0},doDisconnect:function(t){t.error=null,t.connecting=!1,t.connected=!1,t.client=null},doError:function(t,n){t.error||(t.error=n.body?n.body:n),t.connecting=!1,t.connected=!1,t.client=null}},getters:{client:function(t){return t.client},error:function(t){return t.error},connected:function(t){return t.connected},connecting:function(t){return t.connecting}}},E=e("424j");r.a.use(_.a);var F=new _.a.Store({state:{},modules:{auth:$,stomp:q},plugins:[Object(E.a)({})]}),J=function(){return U.a.create()},M=J();M.interceptors.request.use(function(t){var n=F.getters["auth/accessToken"];return n&&(t.headers.Authorization="Bearer "+n),t}),M.interceptors.response.use(function(t){return t},function(t){if(t.response&&(401!==t.response.status||!t.response||!t.response.data||"invalid_token"!==t.response.data.error))throw t;var n=t.config;n.baseURL=null;var e=F.getters["auth/refreshToken"];return console.log("Refreshing JWT ..."),F.dispatch("auth/refresh",{refresh_token:e}).then(function(t){return console.log("JWT Refreshed !"),M.request(n)}).catch(function(t){throw console.log("JWT Refresh Failed !"),"invalid_grant"===t.response.data.error&&(console.log(t.response.data),F.commit("auth/setAuthPayload",null)),t})});var H=M,z=J(),B={name:"Notifications",data:function(){return{subscription:null,notifications:[],loading:!1,err:null}},props:{destination:String},computed:s()({},Object(_.d)("stomp",["error","client","connected"]),Object(_.d)("auth",["auth"])),watch:{connected:{immediate:!0,handler:function(t){this.updateSubscription(this.destination)}},destination:function(t){this.updateSubscription(t)}},mounted:function(){if(!this.auth)return this.$router.push({name:"Login"});this.refresh();var t=g.connect(this,this.auth);console.log(t)},methods:s()({},Object(_.c)("stomp",["doConnect","doWillConnect","doDisconnect","doError"]),{refresh:function(){var t=this;return this.loading=!0,this.err=null,H.get(b.emissionService.url+"/web/notifications").then(function(n){t.notifications=n.data}).catch(function(n){t.err=n}).finally(function(){t.loading=!1})},updateSubscription:function(t){this.client&&this.client.connected&&this.client.subscribe?(this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.subscription=this.client.subscribe(t,this.messageHandler)):this.subscription=null},messageHandler:function(t){if("application/json"!==t.headers["content-type"]&&"application/json;charset=UTF-8"!==t.headers["content-type"])throw new Error("Unknown content type: "+t.headers["content-type"]);this.notifications.splice(0,0,JSON.parse(t.body))}})},I={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"notifications"},[e("b-container",[e("b-row",[e("b-col",{staticClass:"text-center"},[e("b-button",{attrs:{variant:"primary"},on:{click:t.refresh}},[e("i",{staticClass:"fa fa-refresh",attrs:{"aria-hidden":"true"}}),t._v(" Refresh")])],1)],1),t._v(" "),e("transition",{attrs:{name:"fade"}},[t.err?e("b-row",{staticClass:"py-2"},[e("b-col",{staticClass:"m-auto text-center",attrs:{cols:"6"}},[e("b-card",{attrs:{"bg-variant":"danger","text-variant":"white",title:"An error has occured"}},[t._v("\n            "+t._s(t.err.message)+"\n          ")])],1)],1):t._e()],1),t._v(" "),e("transition",{attrs:{name:"fade"}},[t.loading?e("b-row",{staticClass:"py-2"},[e("b-col",{staticClass:"m-auto text-center",attrs:{cols:"6"}},[e("b-card",{attrs:{"bg-variant":"info","text-variant":"white"}},[e("i",{staticClass:"fa fa-spinner fa-spin",attrs:{"aria-hidden":"true"}}),t._v(" Loading ...\n          ")])],1)],1):t._e()],1),t._v(" "),t.loading||t.err?t._e():e("b-row",[e("b-col",[e("transition-group",{attrs:{name:"fade"}},t._l(t.notifications,function(n,o){return e("b-card",{key:o,staticClass:"mt-2 mb-2"},[e("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n              "+t._s(n.title)+"\n            ")]),t._v(" "),e("div",[t._v("\n              "+t._s(n.message)+"\n            ")])])}))],1)],1)],1)],1)},staticRenderFns:[]},P=e("VU/8")(B,I,!1,function(t){e("1AM3")},"data-v-1aabae38",null).exports,K={name:"Main",computed:Object(_.d)("auth",["auth"]),mounted:function(){if(!this.auth)return this.$router.push({name:"Login"})}},Y={render:function(){var t=this.$createElement;return(this._self._c||t)("div")},staticRenderFns:[]},Z=e("VU/8")(K,Y,!1,function(t){e("n3sa"),e("6inx")},"data-v-3fc339ac",null).exports,G={name:"Login",data:function(){return{error:null,form:{username:null,password:null}}},computed:Object(_.d)("auth",["auth"]),methods:s()({},Object(_.b)("auth",["login"]),{submit:function(){var t=this;this.login(this.form).then(function(){t.error=null,t.$router.push({name:"Notifications"})}).catch(function(n){throw n.response&&n.response.data&&n.response.data.error_description?t.error=n.response.data.error_description:n.response&&n.response.data&&n.response.data.error?t.error=n.response.data.error:t.error=n.message,n})}})},X={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"login"},[e("b-container",[e("b-row",[e("b-col",{staticClass:"mx-auto",attrs:{md:"4"}},[e("b-card",{staticClass:"login__card",class:{"login__card--error":t.error}},[e("h5",{staticClass:"mb-0",attrs:{slot:"header"},slot:"header"},[t._v("Connexion")]),t._v(" "),e("b-form",{on:{submit:function(n){n.preventDefault(),t.submit(n)}}},[e("b-form-group",{staticClass:"login__username-group"},[e("b-form-input",{attrs:{type:"text",required:"",placeholder:"Nom d'utilisateur"},model:{value:t.form.username,callback:function(n){t.$set(t.form,"username",n)},expression:"form.username"}})],1),t._v(" "),e("b-form-group",{staticClass:"login__password-group"},[e("b-form-input",{attrs:{type:"password",required:"",placeholder:"Mot de passe"},model:{value:t.form.password,callback:function(n){t.$set(t.form,"password",n)},expression:"form.password"}})],1),t._v(" "),e("b-button",{staticClass:"login__submit-button",attrs:{variant:"primary",type:"submit"}},[t._v("Se connecter")])],1),t._v(" "),t.error?e("div",{staticClass:"login__footer",attrs:{slot:"footer"},slot:"footer"},[e("span",{staticClass:"login__message--error"},[t._v(t._s(t.error))])]):t._e()],1)],1)],1)],1)],1)},staticRenderFns:[]},Q=e("VU/8")(G,X,!1,function(t){e("Vlk5")},"data-v-3e7a27bc",null).exports;r.a.use(W.a);var tt=new W.a({routes:[{path:"/",name:"Main",component:Z},{path:"/login",name:"Login",component:Q},{path:"/notifications",name:"Notifications",component:P,props:{destination:"/user/queue/notification"}}]}),nt=e("e6fC");e("Jmt5"),e("9M+g"),e("5W1q");r.a.use(nt.a),r.a.config.productionTip=!1,new r.a({el:"#app",router:tt,store:F,template:"<App/>",components:{App:D}})},NXGl:function(t,n){},SsFf:function(t,n,e){"use strict";var o=e("xT7b").a,r=e("VU/8")(o,null,!1,function(t){e("Kku6")},null,null);n.a=r.exports},Vlk5:function(t,n){},jdje:function(t,n){},kNIM:function(t,n){},mjqL:function(t,n){},n3sa:function(t,n){},r15W:function(t,n,e){"use strict";var o=e("E9Zr").a,r=e("VU/8")(o,null,!1,function(t){e("weWZ")},null,null);n.a=r.exports},sc01:function(t,n){},weWZ:function(t,n){}},["NHnr"]);
//# sourceMappingURL=app.b4cd056932b73de0dff4.js.map